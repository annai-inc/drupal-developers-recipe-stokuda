---
marp: true
theme: gaia
_class: invert
---

<!-- _class: lead -->
# Drupalの主要なサブシステム

---

## Routing

Webアプリケーションの処理の全てはルーティングから始まります。
もし「ルーティング」という言葉に馴染みがない場合、ここで一旦進めるのを止めて意味を調べてみてください(ネットワーク装置のルーティングと混同しないように注意が必要です)。

それくらい、ルーティングという概念を理解することは重要です。

---

Drupalの処理は特定のパス（またはリソース）にユーザー（またはシステム）がアクセスするところから始まります。

これは、そのリソースをフローにマッピングするルートに変換されます。このフローは、（できれば）成功した​​応答または少なくとも正常な失敗を返します。

Drupal 8のルーティングシステムは、以前のバージョンで使用されていた方法から大きくシフトしています。

Drupal 7以前では、ルーティングシステムはDrupal独自に開発されたものでした。古いバージョンのDrupalを使ったことのある方であれば `hook_menu` という関数名に馴染みがあると思います。

---

`hook_menu` のことはもう忘れましょう。
Drupal 8では Symfonyの [Routingコンポーネント](http://symfony.com/doc/current/components/routing.html) が採用されました。

Drupalのモジュールでどのようにルーティングを制御するかについては、3章でサンプルコードを交えて解説します。

---

## Entity

`Entity` はデータをモデリングし、Drupalを制御する非常に強力な方法です。

開発者向けにざっくり説明すると、Ruby on RailsのActiveRecordや、LaravelのEloquent ORMが、DrupalではEntityに当たります(もちろん、厳粛にはかなり違います)。

Drupal 7以前のバージョンでは、最も有名なタイプのエンティティとしてノードがありました。つまり、Drupal上で管理される各ページのコンテンツ(ノード)は、フレームワーク内部ではEntityとして扱われています。

---

Drupal 8では、Entityシステム全体が刷新され、ユーザー、メニュー、ファイル、設定など、非常に多くのデータがEntityとして管理されるようになりました。

基底クラスである `\Drupal\Core\Entity\Entity` の [派生クラス](https://www.drupal.org/files/classDrupal_Entities.png) を見ると、コアのコードだけでもすごいことになっているのがわかります。

---

すべてのエンティティタイプには、同じタイプの異なるバリエーションである複数のバンドル(`bundle`)を含めることができ、それらに異なるフィールドを含めることができます（一部のベースフィールドを共有することもできます）。

bundleの例として、Drupalコアの `standard` インストールプロファイルには `Basic Page` や `Article` などのいくつかのbundleが含まれたNodeエンティティタイプが定義されています。

さらに、`User`, `Comment`, `File` など、いくつかの他のタイプも存在します。

---

独自のEntity Typeを定義する場合、Drupal 7ではcontirbute moduleを追加する必要がありました。Drupal 8では、Entityシステムの全てがコアに含まれており、Drupal 7のEntityより更に標準化されています。

Drupal 8に存在するエンティティのタイプはこれらだけではありません。前述の例はすべてコンテンツエンティティタイプです。

ただし、Drupal 8では、構成エンティティタイプも導入されました。前者はコンテンツのモデリング用ですが、実際には、データベースに保存でき、その環境に固有のデータを保持するものです。

ただし、構成の保存には使用されません。ユーザーとコンテンツは、ある環境から別の環境に（通常）展開する必要がないため、素晴らしい例です。

---

一方、後者は構成のエクスポート可能なアイテムであり、複数存在する場合があります。

たとえば、特定のエンティティタイプには複数のバンドルが存在する可能性があるため、コンテンツエンティティバンドルは素晴らしい例です。

バンドルごとに異なるメタデータと情報が保存されており、すべての環境に展開する必要があります。

つまり、これらはサイトが正しく機能するための基本です。

---

エンティティシステムを理解することは、カスタムデータとコンテンツをモデル化する強力な方法を提供するため、Drupal 8で開発を行うために不可欠です。

ノードはジョブの唯一のツールではなく、適切なエンティティアーキテクチャがないため、以前のDrupalバージョンでは目的を超えて使用されていました。
